#!/usr/bin/env node

const express = require('express')
const http = require('http')
const path = require('path')
const program = require('commander')

const app = express()
const httpServer = http.Server(app)

program
  .version(require(`${__dirname}/../package.json`).version)
  .option('--root <path>', 'Path to serve NPM packages from')
  .option('--port [number]', 'Local HTTP port to bind the server to (defaults to 3000)')
  .parse(process.argv);

if (!program.root) {
  console.error(program.help())
  process.exit(1)
}

const port = program.port || 3000

app.get('/:name/', (req, res) => res.sendFile(`${req.params.name}/index.json`, {root: path.resolve(program.root)}))
app.get('/:name/:file', (req, res) => res.sendFile(`${req.params.name}/${req.params.file}`, {root: path.resolve(program.root)}))

httpServer.listen(port, () => console.log(`Listening on port *:${port}`))
